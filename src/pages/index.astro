---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import { SITE, HOME, SOCIALS } from "@consts";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

import { Image } from "astro:assets";
import indexImg from "../../src/assets/gifs/g1UX.gif";

const blog = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects: CollectionEntry<"projects">[] = (
  await getCollection("projects")
)
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);
---

<Layout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <aside data-pagefind-ignore>
      <div class="mb-6 mt-[-25px] relative">
        <Image src={indexImg} alt="gif-yw4rf" class="w-full h-60" />
        <h2 id="ipDisplay" class="text-[#4AF626] mt-[-9px] font-bold"></h2>
      </div>      
      <h1 class="font-semibold text-black dark:text-white">
        Tobias Gabriel F. | Cybersecurity Enthusiast | SOC | DFIR | Hands-on Penetration Testing | CTF Player
      </h1>
      <div class="space-y-14">
        <section>
          <article class="space-y-0">
            <span>
              <p>
                I'm a Computer Networking student with a strong self-taught background in cybersecurity, specializing in intrusion detection and digital forensics.
                I have hands-on experience in penetration testing and system analysis, and I'm currently deepening my knowledge of Blue Team operations and defensive security.
                I'm particularly interested in malware analysis and reverse engineering, and I'm actively learning C to strengthen my low-level programming and analysis skills.
                Based in Buenos Aires, Argentina, I'm continuously working to grow as a cybersecurity professional.</p>
            </span>
          </article>
        </section>
        <section class="animate space-y-4">
          <div class="inline-block">
          <h2 class="font-semibold text-black dark:text-white">
            Get in touch!
          </h2>
          <div class="h-1 bg-gray-500 mt-1 w-6"></div>
        </div>
          
          <ul class="not-prose flex flex-col gap-2">
            <li class="">
              <Link
                href={`mailto:${SITE.EMAIL}`}
                aria-label={`Email ${SITE.TITLE}`} 
              >
                {SITE.EMAIL}
              </Link>
            </li>
            {
              SOCIALS.map((SOCIAL) => (
                <li class="flex items-center gap-x-2">
                  <Link
                    href={SOCIAL.HREF}
                    external
                    aria-label={`${SITE.TITLE} on ${SOCIAL.NAME}`}
                  >
                    <span class="flex items-center gap-x-2">
                      <i class={SOCIAL.ICON} style={`color: ${SOCIAL.COLOR}`}></i>
                      {SOCIAL.NAME}
                    </span>
                  </Link>
                </li>
              ))
            }
          </ul>
        </section>        

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
          <div class="inline-block">
            <h2 class="font-semibold text-black dark:text-white">
              Latest posts
            </h2>
            <div class="h-1 bg-gray-500 mt-1 w-6"></div>
          </div>
            <Link href="/blog"> See all posts </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              blog.map((post) => (
                <li>
                  <ArrowCard entry={post} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class="animate space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-y-2">
          <div class="inline-block">
            <h2 class="font-semibold text-black dark:text-white">
              Recent projects
            </h2>
            <h2 class="font-semibold text-black dark:text-white">
          </div>
            <Link href="/projects"> See all projects </Link>
          </div>
          <ul class="not-prose flex flex-col gap-4">
            {
              projects.map((project) => (
                <li>
                  <ArrowCard entry={project} />
                </li>
              ))
            }
          </ul>
        </section>
      </div>
    </aside>
  </Container>
</Layout>
<script>
  async function getIp() {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        const ipDisplay = document.getElementById('ipDisplay');
        if (ipDisplay) {
            ipDisplay.innerHTML = `>> nc ${data.ip} 1717 -e sh`;
        }
    } catch (error) {
        console.error('Error al obtener la IP:', error);
    }
}

document.addEventListener('DOMContentLoaded', getIp);
</script>
<script is:inline src="https://kit.fontawesome.com/7679e0cb88.js" crossorigin="anonymous"></script>